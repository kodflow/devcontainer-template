# Claude Code Core Rules

## 1. MCP-FIRST (MANDATORY)

Use MCP tools BEFORE CLI fallbacks:
- `mcp__grepai__*` before Grep
- `mcp__github__*` before `gh`
- `mcp__codacy__*` before codacy-cli
- `mcp__playwright__*` before npx playwright

MCP has pre-configured auth. NEVER ask for tokens if MCP is configured.

## 2. GREPAI-FIRST (MANDATORY)

| Need | Tool |
|------|------|
| Semantic search | `grepai_search` |
| Find callers | `grepai_trace_callers` |
| Exact string | Grep (fallback) |
| Regex pattern | Grep (fallback) |

Fallback to Grep only if: grepai returns 0 results, exact match needed, or MCP unavailable.

## 3. NO AI IN COMMITS

Forbidden: `Co-Authored-By: Claude/AI`, `Generated by AI`, robot emoji.
Enforced by `commit-validate.sh` hook.

## 4. SKILLS

| Skill | Purpose |
|-------|---------|
| `/init` | **Personalize + validate** (merged wizard) |
| `/git` | Branch + commit + PR |
| `/review` | Code review |
| `/plan` | Planning mode |
| `/do` | Task execution |

| `/secret` | Secure secrets (1Password + Vault-like paths) |

## 5. CONTEXT HIERARCHY

```
/workspace/CLAUDE.md         # Project (primary)
├── .devcontainer/CLAUDE.md  # Container
│   └── images/.claude/CLAUDE.md  # THIS FILE
└── src/CLAUDE.md            # Source
```

Each file < 100 lines. Read at session start.

## 6. GIT WORKFLOW

Never commit to main directly. Use `/git --commit` which:
1. Creates branch
2. Commits with conventional format
3. Opens PR

## 7. SAFEGUARDS

Ask before deleting: `.claude/`, `.devcontainer/`, commands, scripts, agents.
When refactoring: move content, never delete logic.

## 8. CONTEXT RECOVERY

On session start, check `/workspace/.claude/logs/<branch>/checkpoint.json`.
If interrupted task found, resume from last action.

## Quick Check

Before any action: MCP available? Tokens in env? On feature branch? CLAUDE.md read?
