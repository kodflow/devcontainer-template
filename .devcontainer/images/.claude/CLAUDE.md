# Claude Code Core Rules

## 1. MCP-FIRST (MANDATORY)

**Use MCP tools BEFORE CLI binaries.**

| Service | MCP (priority) | CLI (fallback) |
|---------|----------------|----------------|
| Search | `mcp__grepai__*` | Grep |
| GitHub | `mcp__github__*` | gh CLI |
| Code Quality | `mcp__codacy__*` | codacy-cli |
| Browser | `mcp__playwright__*` | npx playwright |
| Docs | `mcp__context7__*` | WebFetch |

**Why:** Pre-configured auth in mcp.json, structured JSON responses.

## 2. GREPAI-FIRST (MANDATORY)

| Task | Tool |
|------|------|
| Semantic search | `grepai_search` |
| Find callers | `grepai_trace_callers` |
| Exact string match | Grep (fallback) |
| Regex pattern | Grep (fallback) |

**Fallback to Grep:** grepai returns 0 results OR exact match needed OR MCP unavailable.

## 3. NO AI MENTIONS (MANDATORY)

**Forbidden in commits/docs:**
- `Co-Authored-By: Claude/AI/GPT`
- `Generated by AI`, `AI-assisted`
- Robot emoji, tool names

**Enforced by:** `commit-validate.sh` hook.

## 4. SKILLS

| Skill | Usage |
|-------|-------|
| `/git` | Branch + commit + PR |
| `/review` | Code review RLM |
| `/plan` | Planning mode |
| `/do` | Iterative execution |
| `/improve` | Docs enhancement |
| `/search` | Documentation research |
| `/test` | E2E with Playwright |
| `/warmup` | Context pre-loading |

## 5. SAFEGUARDS (ABSOLUTE)

**NEVER delete without approval:**
- `.claude/` directory
- `.devcontainer/` directory
- `.claude/commands/*.md`

## 6. GIT WORKFLOW

**NEVER commit to main directly.** Use `/git --commit` → creates branch + PR.

## 7. CONTEXT HIERARCHY

```
/workspace/CLAUDE.md              # Project overview
├── .devcontainer/images/CLAUDE.md # MCP, tools, hooks
│   └── .claude/CLAUDE.md          # THIS FILE - Core rules
└── .devcontainer/features/CLAUDE.md
```

**Rule:** Read CLAUDE.md at session start + when entering directories.

## 8. CONTEXT RECOVERY

**On session start, check:** `/workspace/.claude/logs/<branch>/checkpoint.json`

```bash
BRANCH=$(git rev-parse --abbrev-ref HEAD | tr '/ ' '__')
cat "/workspace/.claude/logs/$BRANCH/checkpoint.json" | jq .
```

## Quick Reference

```yaml
before_action:
  - mcp_available: "Check mcp.json"
  - commit_clean: "No AI mentions"
  - branch_safe: "Not on main"
```
