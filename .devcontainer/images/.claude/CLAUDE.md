# Claude Code Core Rules

## 1. MCP-FIRST RULE (MANDATORY)

**ALWAYS use MCP tools BEFORE falling back to CLI binaries.**

```yaml
priority_order:
  github:
    1st: mcp__github__*          # PR, Issues, Repos
    fallback: gh CLI
  search:
    1st: mcp__grepai__*          # Semantic code search
    fallback: Grep tool
  code_quality:
    1st: mcp__codacy__*          # Code analysis
    fallback: codacy-cli
  browser:
    1st: mcp__playwright__*      # Browser automation
    fallback: npx playwright
  docs:
    1st: mcp__context7__*        # Library documentation
    fallback: WebFetch
```

**Why MCP-first:**
- Pre-configured authentication (tokens in mcp.json)
- Structured JSON responses (no text parsing)
- Single source of truth for credentials
- NEVER ask user for tokens if MCP is configured

## 2. ENVIRONMENT AWARENESS (MANDATORY)

**ALWAYS check environment variables and configuration files.**

```bash
# Check for tokens (masked output)
env | grep -E 'TOKEN|KEY|SECRET|API' | sed 's/=.*/=***/'

# Check project .env files
cat /workspace/.env 2>/dev/null
cat .devcontainer/.env 2>/dev/null
```

**Rules:**
- MCP tokens are pre-configured in `/workspace/mcp.json`
- NEVER ask user for tokens if environment provides them
- Check `.env` files before requesting credentials

## 3. NO AI MENTIONS IN COMMITS (MANDATORY)

**NEVER include AI references in commit messages.**

Forbidden patterns:
- `Co-Authored-By: Claude/Anthropic/OpenAI/AI/GPT/Copilot`
- `Generated by/with AI/Claude/GPT`
- `AI-assisted`, `ai assisted`
- Robot emoji, tool names (claude-code, chatgpt)

**Enforcement:** `commit-validate.sh` hook blocks violations automatically.

## 4. SKILLS & COMMANDS

**Available skills (use Skill tool to invoke):**

| Skill | Usage | Description |
|-------|-------|-------------|
| `/git` | `/git --commit` | Branch + commit + PR workflow |
| `/review` | `/review` | AI-powered code review |
| `/search` | `/search <topic>` | Documentation research |
| `/plan` | `/plan` | Enter planning mode |
| `/do` | `/do <task>` | Iterative task execution |
| `/test` | `/test` | E2E testing with Playwright |
| `/init` | `/init` | Project initialization check |
| `/update` | `/update` | DevContainer template update |
| `/improve` | `/improve` | Docs QA for design patterns |

## 5. CONTEXT HIERARCHY (MANDATORY)

**Read CLAUDE.md files for full project context.**

```
/workspace/CLAUDE.md                    # Project rules (primary)
├── .devcontainer/CLAUDE.md             # Container config
│   └── images/CLAUDE.md                # Docker image details
│       └── .claude/CLAUDE.md           # THIS FILE - Core rules
├── .devcontainer/features/CLAUDE.md    # Features overview
│   └── languages/*/RULES.md            # Language-specific rules
└── src/CLAUDE.md                       # Source code context
```

**Rules:**
- Read `/workspace/CLAUDE.md` at session start
- Read relevant CLAUDE.md when entering a directory
- UPDATE CLAUDE.md when modifying code structure
- More details deeper in tree, each <60 lines

## 6. GIT WORKFLOW (MANDATORY)

**NEVER commit directly to main/master.**

```bash
# WRONG - Direct commit to main
git commit -m "feat: something"
git push origin main

# CORRECT - Use /git skill
/git --commit   # Creates branch, commits, opens PR
```

**Enforcement:** Use `/git` skill which automatically:
1. Creates feature/fix branch
2. Commits with conventional format
3. Pushes to remote
4. Creates Pull Request

## 7. SAFEGUARDS (ABSOLUTE - NO BYPASS)

**NEVER delete without EXPLICIT user approval:**

```yaml
protected_paths:
  - .claude/           # Claude configuration
  - .devcontainer/     # Container configuration
  - .claude/commands/  # Skill definitions
  - .claude/scripts/   # Hook scripts
  - .claude/agents/    # Agent definitions
```

**When simplifying/refactoring:**
- Move content to separate files, NEVER delete logic
- Ask before removing any feature, even if seemingly redundant

## Quick Reference

```yaml
# Before ANY action, verify:
mcp_available: "Check mcp.json for configured servers"
env_tokens: "Check env vars for pre-configured auth"
commit_clean: "No AI mentions in message"
context_read: "Read relevant CLAUDE.md files"
branch_safe: "Not on main/master for commits"
```
