# Dépannage

## Problèmes courants

### Le container ne démarre pas

**Symptôme** : erreur au `Reopen in Container`

1. Vérifier que Docker est lancé : `docker ps`
2. Vérifier l'espace disque : `docker system df`
3. Nettoyer si nécessaire : `docker system prune`
4. Reconstruire sans cache : `Ctrl+Shift+P` → `Dev Containers: Rebuild Without Cache`

### grepai ne fonctionne pas

**Symptôme** : `grepai_search` retourne des erreurs

1. Vérifier Ollama : `curl http://host.docker.internal:11434/api/tags`
2. Si Ollama n'est pas installé, grepai fonctionne quand même mais sans embeddings. Le watchdog réessaie toutes les 60s.
3. Forcer une ré-indexation : supprimer `~/.cache/grepai/` et relancer `/warmup`

### Les tokens MCP ne sont pas pris en compte

**Symptôme** : `mcp__github__*` retourne des erreurs d'auth

1. Vérifier `.devcontainer/.env` contient le bon token
2. Rebuild le container (le `.env` est lu au démarrage)
3. Vérifier le `mcp.json` généré : `cat /workspace/mcp.json`

### Les hooks post-edit échouent

**Symptôme** : erreurs de lint/format après chaque édition

1. Le hook est **non-bloquant** : l'erreur est affichée mais ne bloque pas Claude
2. Si un linter n'est pas installé pour votre langage, le hook le détecte et skip
3. Pour désactiver un hook temporairement : éditer `~/.claude/settings.json`

### VPN ne se connecte pas

**Symptôme** : `/vpn --connect` échoue

1. Vérifier que `OP_SERVICE_ACCOUNT_TOKEN` est configuré
2. Vérifier que le profil VPN existe dans 1Password : `/vpn --list`
3. Vérifier les capabilities Docker : `NET_ADMIN` et `/dev/net/tun` doivent être activés (c'est le cas par défaut dans `docker-compose.yml`)

### Fichiers Claude manquants au démarrage

**Symptôme** : commandes ou agents introuvables

`postStart.sh` restaure les fichiers depuis `/etc/claude-defaults/`. Si le problème persiste :

```bash
# Restauration manuelle
cp -r /etc/claude-defaults/* ~/.claude/
```

### Le commit est bloqué

**Symptôme** : `commit-validate.sh` refuse le commit

Le hook bloque les commits contenant des mentions d'IA (Co-Authored-By Claude, Generated by AI, etc.). C'est intentionnel.

Si `security.sh` bloque le commit, c'est qu'un secret a été détecté dans les fichiers stagés. Vérifier avec `git diff --cached` et retirer le secret.

## Vérifications rapides

```bash
# État général
docker ps                           # Container running ?
cat /workspace/mcp.json             # MCP configuré ?
echo $SHELL                         # Devrait être /bin/zsh
ls ~/.claude/commands/              # Commandes présentes ?
ls ~/.claude/agents/                # Agents présents ?

# Services
curl -s http://host.docker.internal:11434/api/tags  # Ollama ?
op --version                        # 1Password CLI ?
```
